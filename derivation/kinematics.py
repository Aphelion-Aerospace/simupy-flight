import numpy


def kinematics_state_function(self, t, p_x, p_y, p_z, q_0, q_1, q_2, q_3, v_x, v_y, v_z, omega_X, omega_Y, omega_Z, A_X, A_Y, A_Z, alpha_X, alpha_Y, alpha_Z, c_q):
    [g_x, g_y, g_z] = self.gravity(p_x,p_y,p_z).ravel()
    x0 = (1/2)*omega_X
    x1 = (1/2)*q_2
    x2 = (1/2)*q_3
    x3 = (1/2)*omega_Y
    x4 = (1/2)*omega_Z
    x5 = q_0**2
    x6 = q_1**2
    x7 = q_2**2
    x8 = q_3**2
    x9 = 1/(x5 + x6 + x7 + x8)
    x10 = 2*A_Y
    x11 = q_0*q_3
    x12 = q_1*q_2
    x13 = 2*A_Z
    x14 = q_0*x13
    x15 = q_3*x13
    x16 = 2*A_X
    return (numpy.array([v_x, v_y, v_z, c_q*q_0 - omega_Y*x1 - omega_Z*x2 - q_1*x0, c_q*q_1 - omega_Y*x2 + omega_Z*x1 + q_0*x0, c_q*q_2 + q_0*x3 - q_1*x4 + q_3*x0, c_q*q_3 + q_0*x4 + q_1*x3 - q_2*x0, x9*(A_X*x5 + A_X*x6 - A_X*x7 - A_X*x8 + g_x*x5 + g_x*x6 + g_x*x7 + g_x*x8 + q_1*x15 + q_2*x14 - x10*x11 + x10*x12), x9*(A_Y*x5 - A_Y*x6 + A_Y*x7 - A_Y*x8 + g_y*x5 + g_y*x6 + g_y*x7 + g_y*x8 - q_1*x14 + q_2*x15 + x11*x16 + x12*x16), x9*(A_Z*x5 - A_Z*x6 - A_Z*x7 + A_Z*x8 + g_z*x5 + g_z*x6 + g_z*x7 + g_z*x8 + q_0*q_1*x10 - q_0*q_2*x16 + q_1*q_3*x16 + q_2*q_3*x10), alpha_X, alpha_Y, alpha_Z]))

def ic_from_planetodetic(self, lamda_D, phi_D, h_D, V_N, V_E, V_D, psi, theta, phi, p_B, q_B, r_B):
    [p_x, p_y, p_z] = self.planetodetics.pd2pcf(lamda_D,phi_D,h_D).ravel()
    x0 = numpy.cos(phi)
    x1 = numpy.cos(lamda_D)
    x2 = numpy.cos(psi)
    x3 = x1*x2
    x4 = x0*x3
    x5 = numpy.sin(theta)
    x6 = numpy.cos(phi_D)
    x7 = x5*x6
    x8 = x1*x7
    x9 = numpy.sin(phi)
    x10 = numpy.sin(psi)
    x11 = x10*x6
    x12 = x11*x9
    x13 = numpy.sin(phi_D)
    x14 = numpy.cos(theta)
    x15 = x13*x14
    x16 = x0*x15
    x17 = numpy.sin(lamda_D)
    x18 = x10*x14
    x19 = x17*x18
    x20 = x10*x9
    x21 = x1*x5
    x22 = x20*x21
    x23 = x2*x7
    x24 = x0*x23
    x25 = x0*x17
    x26 = x10*x25
    x27 = x13*x26
    x28 = x15*x3
    x29 = x14*x6
    x30 = x29*x9
    x31 = x17*x30
    x32 = x13*x5
    x33 = x17*x2
    x34 = x33*x9
    x35 = x32*x34
    x36 = x12 - x16 - x19 + x22 + x24 + x27 - x28 - x31 - x35 + x4 + x8 + 1
    x37 = numpy.sqrt(x36)
    x38 = x3*x9
    x39 = x13*x20
    x40 = x0*x10
    x41 = x0*x33
    x42 = -x0*x11 - x15*x9 + x17*x39 - x21*x40 + x23*x9 + x25*x29 + x32*x41 + x38
    x43 = (1/2)/x37
    x44 = x0*x1*x29 + x1*x39 + x2*x29 + x26*x5 + x32*x4 + x32 - x34
    x45 = -x1*x13*x40 + x1*x18 + x1*x30 - x15*x33 + x17*x20*x5 + x17*x7 + x32*x38 + x41
    x46 = V_D*x6
    x47 = V_N*x13
    x48 = 1/x36
    x49 = (1/4)*x48
    x50 = x44**2*x49
    x51 = x42**2*x49
    x52 = x45**2*x49
    x53 = (1/4)*x12 - 1/4*x16 - 1/4*x19 + (1/4)*x22 + (1/4)*x24 + (1/4)*x27 - 1/4*x28 - 1/4*x31 - 1/4*x35 + (1/4)*x4 + (1/4)*x8 + 1/4
    x54 = 1/(x50 + x51 + x52 + x53)
    x55 = (1/2)*self.planetodetics.omega_p
    x56 = x44*x55
    x57 = x42*x55
    x58 = x45*x48
    return (numpy.array([p_x, p_y, p_z, (1/2)*x37, x42*x43, -x43*x44, x43*x45, -V_E*x17 - self.planetodetics.omega_p*p_y - x1*x46 - x1*x47, V_E*x1 + self.planetodetics.omega_p*p_x - x17*x46 - x17*x47, -V_D*x13 + V_N*x6, x54*(p_B*x50 + p_B*x51 + p_B*x52 + p_B*x53 + x56 + x57*x58), x54*(q_B*x50 + q_B*x51 + q_B*x52 + q_B*x53 - x56*x58 + x57), x54*(-self.planetodetics.omega_p*x50 - self.planetodetics.omega_p*x51 + self.planetodetics.omega_p*x52 + self.planetodetics.omega_p*x53 + r_B*x50 + r_B*x51 + r_B*x52 + r_B*x53)]))

def kinematics_output_function(self, t, p_x, p_y, p_z, q_0, q_1, q_2, q_3, v_x, v_y, v_z, omega_X, omega_Y, omega_Z):
    [lamda_D, phi_D, h_D] = self.planetodetics.pcf2pd(p_x,p_y,p_z).ravel()
    lamda_D = lamda_D - self.planetodetics.omega_p*t
    [W_N, W_E, W_D] = self.winds(t,lamda_D,phi_D,h_D).ravel()
    [rho, c_s, mu] = self.atmosphere(t,lamda_D,phi_D,h_D).ravel()
    x0 = q_2**2
    x1 = q_3**2
    x2 = x0 + x1
    x3 = q_0**2
    x4 = q_1**2
    x5 = x3 + x4
    x6 = 1/(x2 + x5)
    x7 = -x3
    x8 = -x4
    x9 = x2 + x7 + x8
    x10 = lamda_D + self.planetodetics.omega_p*t
    x11 = numpy.sin(x10)
    x12 = numpy.cos(x10)
    x13 = q_0*q_3
    x14 = q_1*q_2
    x15 = 2*x13 + 2*x14
    x16 = numpy.cos(phi_D)
    x17 = q_1*q_3
    x18 = q_0*q_2
    x19 = 2*x17 - 2*x18
    x20 = numpy.sin(phi_D)
    x21 = x12*x9
    x22 = x11*x20
    x23 = 2*x20
    x24 = x11*x16
    x25 = q_0*q_1
    x26 = q_2*q_3
    x27 = x25 + x26
    x28 = x4 + x7
    x29 = -x0
    x30 = x1 + x29
    x31 = x12*x16
    x32 = 2*x31
    x33 = -x1
    x34 = x0 + x33
    x35 = x17 + x18
    x36 = self.planetodetics.omega_p**2
    x37 = W_E*x12
    x38 = 2*v_y
    x39 = W_N*x16
    x40 = 2*v_z
    x41 = self.planetodetics.omega_p*p_x
    x42 = W_D*x20
    x43 = W_E*x11
    x44 = 2*v_x
    x45 = self.planetodetics.omega_p*p_y
    x46 = W_D*x31
    x47 = W_D*x24
    x48 = 2*x41
    x49 = 2*x45
    x50 = W_N*x23
    x51 = x12*x50
    x52 = x11*x50
    x53 = W_D**2 + W_E**2 + W_N**2 + p_x**2*x36 + p_y**2*x36 + v_x**2 + v_x*x51 + v_y**2 + v_y*x52 + v_z**2 - x37*x38 + x37*x48 - x38*x41 + x38*x47 - x39*x40 + x40*x42 - x41*x52 + x43*x44 + x43*x49 + x44*x45 + x44*x46 + x45*x51 + x46*x49 - x47*x48
    x54 = numpy.sqrt(x53*((x53>0.0)+0.5*(x53==0.0)))
    x55 = v_z - x39 + x42
    x56 = x3 + x8
    x57 = W_N*x20
    x58 = v_x + x12*x57 + x43 + x45 + x46
    x59 = 2*x58
    x60 = v_y + x11*x57 - x37 - x41 + x47
    x61 = x6*(2*x27*x55 + x59*(-x13 + x14) + x60*(x34 + x56))/x54
    x62 = 2*self.planetodetics.omega_p
    x63 = x12*x20
    return (numpy.array([p_x, p_y, p_z, q_0, q_1, q_2, q_3, v_x, v_y, v_z, omega_X, omega_Y, omega_Z, lamda_D, phi_D, h_D, numpy.arctan2(x6*(x11*x9 + x12*x15), x6*(-x15*x22 + x16*x19 + x20*x21)), -numpy.arcsin(x6*(-x15*x24 + x16*x21 + x23*(-x17 + x18))), numpy.arctan2(x6*(-x23*x27 + x24*(x28 + x30) + x32*(x13 - x14)), x6*(x20*(x28 + x34) + 2*x24*(x25 - x26) - x32*x35)), rho, c_s, mu, x54, numpy.arctan2(x6*(x35*x59 + x55*(x30 + x56) + 2*x60*(-x25 + x26)), x6*(x15*x60 + x19*x55 + x58*(x29 + x33 + x5))), numpy.arcsin(numpy.select([numpy.greater(x61, 1.0),numpy.less(x61, -1.0),numpy.greater(x54, 0.0)], [1.0,-1.0,x61], default=0.0)), x6*(omega_X*x0 + omega_X*x1 + omega_X*x3 + omega_X*x4 - x17*x62 + x18*x62), x6*(omega_Y*x0 + omega_Y*x1 + omega_Y*x3 + omega_Y*x4 - x25*x62 - x26*x62), x6*(omega_Z*x0 + omega_Z*x1 + omega_Z*x3 + omega_Z*x4 + self.planetodetics.omega_p*x0 - self.planetodetics.omega_p*x1 - self.planetodetics.omega_p*x3 + self.planetodetics.omega_p*x4), -v_x*x63 - v_y*x22 + v_z*x16 + x22*x41 - x45*x63, -v_x*x11 + v_y*x12 - x11*x45 - x12*x41, -v_x*x31 - v_y*x24 - v_z*x20 + x24*x41 - x31*x45, W_N, W_E, W_D]))
